<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU"
        crossorigin="anonymous">
    <title>Space Jam</title>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.2/angular.min.js"></script>
    <link rel="stylesheet" href="css/styles-desktop.css">
    <link rel="stylesheet" href="css/style-mobile.css">
</head>

<body ng-app="SpaceJam" ng-controller="AppController">

    <div class="container-fluid" ng-controller="LoginController" ng-show="showLogin">
        <div class="login">
            <div class="login-section">
                <h2><b>Welcome to SpaceJam</b></h2>
                <br>
                <br>
                <br>
                <h4>Please Log into your Spotify Account</h4>
                <br>
                <br>
                <br>
                <br>
                <button class="btn" id="login-btn" onclick="initMap()" ng-click="login()">Connect Spotify</button>
                <h6 style="text-align: center; position: relative; vertical-align: bottom;">By connecting
                    spotify you are accepting <br> their <a target="_blank" href="https://www.spotify.com/us/legal/end-user-agreement/">Terms
                        & Conditions</a> for use</h6>
            </div>
        </div>
    </div>


    <div class="container-fluid" id="player" ng-controller="PlayerController" ng-show="showPlayer">
        <div class="top-bar">
            <i class="fa fa-bars" id="collapse-button" onclick="toggleSidebar()"></i>
            <i id="view-control" onmouseout="initMap()" ng-click="changeview('map')" class="fas fa-map"></i>
            <i id="view-control" ng-click="changeview('search')" class="fas fa-search"></i>
            <i id="view-control" class="fas fa-map-pin" data-toggle="modal" data-target="#postSongModal" ng-click="reset()"></i>
            <h1>Space Jam</h1>
        </div>

        <div class="sidebar" id="sidebar">
            <div class="sidebar-content">
                <h2 style="cursor: pointer;" ng-click="changeview('profile')">{{ userData.USERNAME }}</h2>
                <h4>MSS: {{ userData.POINTS }}</h4>
                <hr>
                <div class="sidebar-nearby-songs">

                </div>
                <hr>
                <div class="options">
                    <i class="fas fa-cog" style="font-size: 30px; cursor: pointer; margin: 10px;">
                        <h6 style="margin-top: 5px;">Settings</h6>
                    </i>
                    <i class="fas fa-question" style="font-size: 30px; cursor: pointer; margin: 10px;">
                        <h6 style="margin-top: 5px;">Help</h6>
                    </i>
                    <a ng-click="logout()">
                        <i style="font-size: 30px; cursor: pointer; margin: 10px;" class="fas fa-sign-out-alt">
                            <h6 style="margin-top: 5px;">Logout</h6>
                        </i>
                    </a>
                </div>
            </div>
        </div>

        <div class="content" id="content">
            <div class="modal fade" id="postSongModal" role="dialog">
                <div class="modal-dialog modal-dialog-centered">
                    <!-- Modal content-->
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4>Post Track To Current Location</h4>
                        </div>
                        <div class="modal-body">
                            <div class="dropdown">
                                <button id="dropdown" class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">
                                    <span id="dropdown-text">{{ selectedTrack }}</span>
                                    <span class="caret"></span></button>
                                <ul class="dropdown-menu">
                                    <span ng-repeat="track in userTracks" ng-if="track.USERNAME == userData.USERNAME"><li><a class="dropdown-item" href="#" ng-click="selectTrack(track.TRACK_NAME)">{{ track.TRACK_NAME }}</a></li></span>
                                </ul>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal" id="modal-btn">Cancel</button>
                            <button type="button" class="btn btn-default" data-dismiss="modal" id="modal-btn" ng-click="postTrack(selectedTrack)">Post</button>
                        </div>
                    </div>
                </div>
            </div>
            <div ng-if="view == 'profile'" class="profile-view">
                <div class="profile-header">
                    <h2 style="margin-top: 10px;">{{ userData.USERNAME }}</h2>
                    <h3>MSS: {{ userData.POINTS }}</h3>
                </div>
                <div class="profile-content">
                    <div class="posted-songs">
                        <div class="posted-item">

                        </div>
                    </div>
                    <div class="collected-songs">
                        <h3>Song Collection</h3>
                        <div class="collected-item" ng-repeat="track in userTracks" ng-if="track.USERNAME == userData.USERNAME">
                            <div class="collected-item-info">
                                <h4>{{ track.TRACK_NAME }}</h4>
                                <h5>{{ track.TRACK_ARTIST }}</h5>
                            </div>
                            <i id="collected-play" ng-click="play(track.uri)" class="fas fa-play" style="font-size: 35px;">
                                <h6 style="margin-top: 5px;">Play</h6>
                            </i>
                        </div>
                        <br>
                    </div>
                </div>
            </div>
            <div ng-if="view == 'map'" class="map-view">
                <div id="map" style="width:100%; height:100%;"></div>
            </div>
            <div ng-if="view == 'search'" class="search-view" ng-controller="SearchController">
                <div class="form-group">
                    <label for="searchTrack" style="font-size: 20px;">Search By Track/Song, Artist, or Album</label>
                    <input ng-model="query" ng-change="search()" type="text" class="form-control" id="searchTrack"
                        placeholder="Enter Track, Artist, or Album">
                </div>
                <div class="tracks">
                    <div class="track-items" ng-repeat="track in tracks.items">
                        <div class="track-info">
                            <h5><b>{{ track.name }}</b></h5>
                            <h5>{{ track.artists[0].name }}</h5>
                        </div>
                        <div class="track-options">
                            <!-- <i id="search-control" ng-click="play(track.uri)" class="fas fa-play" style="font-size: 35px;">
                                        <h6 style="margin-top: 5px;">Play</h6>
                                    </i> -->

                            <i id="search-control" class="fas fa-shopping-cart" style="font-size: 35px;" ng-click="buyTrack(track.name, track.id, track.artists[0].name, track.popularity)">
                                <h6 style="margin-top: 5px;">Points: {{ track.popularity * 40 }}</h6>
                            </i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="bottom-bar" id="bottom-bar">
            <div class="music-info">
                <h5>{{ trackInfo.data.name }}</h5>
                <h6>{{ trackInfo.data.artists[0].name }}</h6>
            </div>
            <h6 class="poster">Posted by: {{ poster }}</h6>
            <div class="track-controls">
                <div class="thumb-up">
                    <i id="control" class="fas fa-thumbs-up" style="font-size: 25px" ng-click="()"></i>
                </div>

                <div class="play-btn">
                    <i id="control" ng-hide="play" ng-click="resume()" class="fas fa-play" style="font-size: 35px;"></i>
                    <i id="control" ng-show="play" ng-click="pause()" class="fas fa-pause" style="font-size: 35px;"></i>
                </div>

                <div class="thumb-down">
                    <i id="control" class="fas fa-thumbs-down" style="font-size: 25px;"></i>
                </div>
            </div>
            <div class="seek">
                <div class="progress-value">{{ progress | displaytime }}</div>
                <div class="slider">
                    <input type="range" ng-model="progress" min="0" max="{{ duration }}" />
                </div>
                <div class="duration-value">{{ duration | displaytime }}</div>
            </div>
        </div>
    </div>


































    <script type="text/javascript">
        function toggleSidebar() {
            var sidebar = document.getElementById("sidebar").classList.toggle("active");
            var bottombar = document.getElementById("bottom-bar").classList.toggle("active");
            var content = document.getElementById('content').classList.toggle('active');
            // var sidebarHeader = document.getElementById('sidebar-header').classList.toggle("active");
            // var nearbySongs = document.getElementById('nearby-songs').classList.toggle("active");
            // var additional = document.getElementById('additional').classList.toggle("active");
        }

        var locations = {
            location1: {
                center: {
                    lat: 29.187928,
                    lng: -81.050409
                }
            }
        }
        function initMap() {
            var map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 40.653458, lng: -100.405642 },
                zoom: 5,
                disableDefaultUI: true
            });
            var infoWindow = new google.maps.InfoWindow;

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    var pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    console.log(pos);
                    angular.element(document.getElementById('player')).scope().currentLocation = pos;
                    infoWindow.setPosition(pos);
                    infoWindow.setContent('Location Found');
                    infoWindow.open(map);
                    map.setCenter(pos);
                    map.setZoom(17.5);
                }, function () {
                    handleLocationError(true, infoWindow, map.getCenter());
                });
            } else {
                handleLocationError(false, infoWindow, map.getCenter());
            }



            // var marker = new google.maps.Marker({
            //     position: angular.element(document.getElementById('player')).scope().location,
            //     map: map,
            //     title: 'My Location'
            // });

            // for (var location in locations) {
            //     var locationRadius = new google.maps.Circle({
            //         strokeColor: '#7d08b6',
            //         strokeOpacity: 0.8,
            //         strokeWeight: 2,
            //         fillColor: '#c518e9',
            //         fillOpacity: 0.35,
            //         map: map,
            //         center: locations[location].center,
            //         radius: 40
            //     });
            // }
        }

        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
            infoWindow.setPosition(pos);
            infoWindow.setContent(browserHasGeolocation ? 'Geolocation faild' : 'no gelocation');
            infoWindow.open(map);
        }
    </script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDU2FyHaBYcS7Hwywd5ky7QDOV2btqcTD8&callback=initMap"
        async defer></script>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>
</body>

<!--Angular References-->
<script src="js/app.js"></script>

<!--Angular Services-->
<script src="js/services/api.js"></script>
<script src="js/services/playback.js"></script>
<script src="js/services/auth.js"></script>
<script src="js/services/playqueue.js"></script>
<script src="js/services/database.js"></script>
<script src="js/services/location.js"></script>

<!--Angular Controllers-->
<script src="js/controllers/login.js"></script>
<script src="js/controllers/player.js"></script>
<script src="js/controllers/search.js"></script>

<!--Angular Filters-->
<script src="js/filters/displaytime.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>

</html>